(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{"3GUV":function(e,t,r){"use strict";var s=r("ERkP"),i=r("rHpw"),n=r("MWbm");class o extends s.Component{shouldComponentUpdate(){return!1}render(){return s.createElement(n.a,{style:a.root})}}const a=i.a.create((e=>({root:{height:5*e.lineHeightsPx.body}})));t.a=o},"5UID":function(e,t,r){"use strict";var s=r("ERkP"),i=r("3XMw"),n=r.n(i),o=r("rHpw"),a=r("+/1j"),c=r("MWbm");const l=n.a.e5b0063d;let h=0;class d extends s.Component{constructor(){super(),this._listDomId=`accessible-list-${h}`,h+=1}render(){const{children:e,title:t}=this.props,r=l({title:t});return s.createElement(c.a,{accessibilityRole:"region","aria-labelledby":this._listDomId},s.createElement(a.a,{accessibilityRole:"heading","aria-level":1,nativeID:this._listDomId,style:o.a.visuallyHidden},t),s.createElement(c.a,{accessibilityLabel:r},e))}}t.a=d},JsJV:function(e,t,r){"use strict";var s=r("6/RC"),i=r("tI3i"),n=r.n(i),o=s.canUseDOM?window.location.href:"",a={addEventListener:function(){},removeEventListener:function(){},canOpenURL:function(){return Promise.resolve(!0)},getInitialURL:function(){return Promise.resolve(o)},openURL:function(e){try{return c(e),Promise.resolve()}catch(e){return Promise.reject(e)}},_validateURL:function(e){n()("string"==typeof e,"Invalid URL: should be a string. Was: "+e),n()(e,"Invalid URL: cannot be empty")}},c=function(e){s.canUseDOM&&(window.location=new URL(e,window.location).toString())};t.a=a},VeNJ:function(e,t,r){"use strict";r.r(t),r.d(t,"TimelineRenderer",(function(){return le}));var s=r("KEM+"),i=r.n(s),n=(r("kYxP"),r("n+Zb")),o=r("ERkP"),a=r("5UID"),c=r("v6aA"),l=r("6/RC"),h=r("1YZw"),d=r("rxPX"),p=Object(d.a)().propsFromActions((()=>({addToast:h.b}))).withAnalytics(),m=r("KNCp"),u=r("lUZE");var _=Object.freeze({Icon:"Icon",IconSmall:"IconSmall",FullWidth:"FullWidth"}),b=r("caTy"),y=r("TnY3"),g=r("TIdA"),v=r("A91F"),f=r("feu+"),C=r("JsJV"),E=r("MWbm"),T=r("oQhu"),I=r("fs1G"),w=r("rcen");class S extends o.PureComponent{constructor(...e){super(...e),i()(this,"_getGraphicProps",Object(T.a)(((e,t)=>{const r=e?({style:t})=>o.createElement(E.a,{style:t},o.createElement(g.a,{accessibilityLabel:"",aspectMode:v.a.exact(e.width/e.height),image:e})):u.a;let s="illustration";return e&&t!==_.IconSmall?t===_.FullWidth&&(s="illustrationFullWidth"):s="icon",{graphic:r,graphicDisplayMode:s}}))),i()(this,"_scribeAction",((e,t)=>{const{analytics:r}=this.props,{action:s,component:i,element:n}=t||{};r.scribe({action:s||e,component:i||"cover",element:n})})),i()(this,"_handleDismiss",(()=>{const{dismissInfo:e,processCallback:t}=this.props,{callbacks:r}=e||{};r&&r.forEach((e=>{t(e)})),e&&(this._scribeAction("dismiss"),this.props.onClose())})),i()(this,"_handlePrimaryCtaClick",(()=>{this._handleCtaClick(this.props.primaryCta,"primary_cta")})),i()(this,"_handleSecondaryCtaClick",(()=>{this.props.secondaryCta&&this._handleCtaClick(this.props.secondaryCta,"secondary_cta")})),i()(this,"_handleCtaClick",(({ctaBehavior:e,callbacks:t,clientEventInfo:r},s)=>{const{addToast:i,processCallback:n,history:o}=this.props;if(this.props.onClose(),this._scribeAction("click",{element:s,...r}),e.dismiss){const{dismiss:t}=e;t&&t.feedbackMessage&&i({text:t.feedbackMessage.text})}if(e.navigate){const{navigate:t}=e,r=t&&Object(b.b)(t.url);r&&(r.external?C.a.openURL(r.pathname):o.push(r.pathname))}t&&t.forEach((e=>n(e)))}))}componentDidMount(){this.props.onImpression&&this.props.onImpression()}render(){const{image:e,imageDisplayType:t,primaryText:r,primaryCta:s,secondaryText:i,secondaryCta:n,details:a,displayType:c,type:l,dismissInfo:h}=this.props,d=o.createElement(w.b,{entities:r.entities,text:r.text}),p=i?o.createElement(w.b,{entities:i.entities,text:i.text}):null;if(l===m.a.Full){const l=a?o.createElement(w.b,{entities:a.entities,text:a.text}):null,{graphic:m,graphicDisplayMode:u}=this._getGraphicProps(e,t);return o.createElement(f.a,{actionLabel:s.text,footer:l,footerAlign:a&&a.alignment===w.a.Center?"center":"left",graphic:m,graphicDisplayMode:u,headline:d,headlineAlign:r.alignment===w.a.Natural?"left":"center",isFullHeightOnMobile:!h&&"CenterCover"!==c,onAction:this._handlePrimaryCtaClick,onClose:this._handleDismiss,onTertiaryAction:this._handleSecondaryCtaClick,subtext:p,subtextAlign:i&&i.alignment===w.a.Natural?"left":"center",tertiaryActionLabel:n&&n.text,withCloseButton:!!h})}return o.createElement(f.a,{actionLabel:s.text,graphicDisplayMode:"none",headline:d,headlineAlign:r.alignment===w.a.Center?"center":"left",onAction:this._handlePrimaryCtaClick,onClose:I.a,onSecondaryAction:this._handleSecondaryCtaClick,secondaryActionLabel:n&&n.text,subtext:p,subtextAlign:i&&i.alignment===w.a.Center?"center":"left",withCloseButton:!1})}}i()(S,"defaultProps",{imageDisplayType:_.Icon});var k=Object(y.a)(p(S));const x={component:"cover",action:"impression"};var L=({activeCover:e,clearActiveCover:t,processCallback:r,scribeAction:s,scribeNamespace:i})=>{const n=((e,t)=>{let r={...e,...x};return t&&(r={...r,component:t.component||r.component,element:t.element||r.element,action:t.action||r.action}),r})(i,e.clientEventInfo),a=()=>{const{cover:{impressionCallbacks:t}}=e;t&&t.forEach((e=>r(e))),s(n)};return"full"===e.type?(c=e.cover,o.createElement(k,{details:c.details||void 0,dismissInfo:c.dismissInfo,displayType:c.displayType,image:c.image,imageDisplayType:c.imageDisplayType||void 0,onClose:t,onImpression:a,primaryCta:c.primaryCoverCta,primaryText:c.primaryText,processCallback:r,secondaryCta:c.secondaryCoverCta,secondaryText:c.secondaryText,type:"full"})):"half"===e.type?function(e){const s="CenterCover"===e.displayType?"full":"half";return o.createElement(k,{displayType:e.displayType,image:e.coverImage?e.coverImage.image:void 0,imageDisplayType:e.coverImage?e.coverImage.imageDisplayType:void 0,onClose:t,onImpression:a,primaryCta:e.primaryCoverCta,primaryText:e.primaryText,processCallback:r,secondaryCta:e.secondaryCoverCta,secondaryText:e.secondaryText,type:s})}(e.cover):null;var c},R=r("8UdT"),A=r("MDbM"),D=(r("C1yv"),r("Qyxo"));class N{constructor(){this._lingerScribed={},this._appearance={}}processPositioningUpdate(e,t,r=Date.now()){const s=P(e,t);return this._lingerTransition(s,r)}flushLingerEvents(e=Date.now()){return this._detectScribeLingerEvents(this._appearance,{},e)}_lingerTransition(e,t){const r=this._appearance;return this._appearance=e.reduce(((e,s)=>(e[s]=r[s]||{start:t,lingered:!1},e)),{}),{allLingerIds:this._detectAllLingerEvents(r,t),scribeLingerEvents:this._detectScribeLingerEvents(r,this._appearance,t)}}_detectAllLingerEvents(e,t){return Object.keys(e).reduce(((r,s)=>{const{start:i,lingered:n}=e[s];return!n&&t-i>=500&&(r.push(s),this._appearance[s]&&(this._appearance[s]={...this._appearance[s],lingered:!0})),r}),[])}_detectScribeLingerEvents(e,t,r){return Object.keys(e).reduce(((s,i)=>{const{start:n}=e[i];return!t[i]&&!this._lingerScribed[i]&&r-n>=500&&(this._lingerScribed[i]=!0,s.push({id:i,start:n,end:r})),s}),[])}}const P=(e,t)=>Object(D.a)(e,(({id:e,rectangle:r})=>O(r,t)>=.5*r.getHeight()?e:void 0)),O=(e,t)=>Math.max(0,Math.min(e.getBottom(),t.getBottom())-Math.max(e.getTop(),t.getTop()));var M=r("Stgo"),U=r("LFzM");var B=({children:e,impressionTracker:t})=>t?o.createElement(U.a.Provider,{value:{impressionTracker:t}},e):e,F=r("OrGc"),V=r("hACr"),j=r("VPAj"),H=r("3GUV"),W=r("v//M"),G=r("rHpw");const K=Object(j.a)(o.createElement(H.a,null)),J=({bottomFetchStatus:e,onBottomRetry:t})=>o.createElement(E.a,{style:z.footer},o.createElement(W.a,{fetchStatus:e,onRequestRetry:t,render:K})),z=G.a.create((e=>({footer:{height:`calc(5 * ${e.lineHeights.body})`}})));var q=o.memo(J),Z=r("xjVt"),Y=r("EUHl"),Q=r("IG4P"),X=r("iBK2"),$=r("b1wW");r("rxtR");const ee=Object.freeze({ON_LINGER:"onLinger"});var te=r("aITJ"),re=r("cFgU"),se=r("iChn"),ie=r("+d3d");const ne=e=>e.entryId,oe=e=>e.sortIndex;const ae=new Map;let ce;class le extends o.PureComponent{constructor(e,t){var r;super(e,t),i()(this,"_adjustFocusBy",(e=>{this._shouldPreventKeyboardShortcuts()||this._scroller&&this._scroller.adjustFocusBy(e)})),i()(this,"_focusNext",(()=>this._adjustFocusBy(1))),i()(this,"_focusPrevious",(()=>this._adjustFocusBy(-1))),i()(this,"_renderLoadBottom",(()=>{const{bottomFetchStatus:e,onBottomRetry:t}=this.props;return o.createElement(q,{bottomFetchStatus:e,onBottomRetry:t})})),i()(this,"_refreshControlWrapper",(e=>{const{canRefresh:t,refreshControl:r,topFetchStatus:s,onRefresh:i}=this.props;return r?o.createElement(r,{canRefresh:t,isRefreshing:s===A.a.LOADING,onRefresh:i},e):e})),i()(this,"_getCellRenderer",Object(T.a)(((e,t)=>{let r;const s={module:t,renderEntry:e=>r(e)};return r=(t,r)=>{const i=e.getHandler(t);return i&&i.render?i.render(t,s,r):null},r}))),i()(this,"_getInitialFocusedEntry",Object(T.a)(((e,t)=>t&&e.find(t)))),i()(this,"_createEntryIndex",Object(T.a)((e=>Object(se.a)(e,(e=>e.entryId))))),i()(this,"_handleBeforeWindowUnload",(()=>{this._flushLingerScribes()})),i()(this,"scrollToTop",(e=>{this._scroller&&this._scroller.scrollToTop(e)})),i()(this,"_shouldPreventKeyboardShortcuts",(()=>{const{isModal:e,withKeyboardShortcuts:t}=this.props;return ce&&!e||!t})),i()(this,"_handleRefreshKeyboardShortcut",Object(ie.a)((()=>{this._shouldPreventKeyboardShortcuts()||this.refreshOrGoTop(!0)}),1e3)),i()(this,"_handleAtBottom",this._proximityHandler((()=>{this.props.onAtBottom&&this.props.onAtBottom()}))),i()(this,"_handleNearBottom",this._proximityHandler((()=>{this.props.onNearBottom()}))),i()(this,"_handleNearTop",this._proximityHandler((()=>{const{onNearTop:e}=this.props;e()}))),i()(this,"_handleAtTop",this._proximityHandler((()=>{this.props.removeAlert&&this.props.removeAlert(),this.props.onAtTop&&this.props.onAtTop()}))),i()(this,"_handleItemsRendered",this._proximityHandler((({viewport:e,positions:t})=>{const r=this._impressionTracker.processPositioningUpdate(t,e);this._scribeLingerEvents(r.scribeLingerEvents),this._handleOnLingerEvents(r.allLingerIds)}))),i()(this,"_handleProcessLingerEvents",(()=>{if(this._impressionTrackerV2){const e=this._impressionTrackerV2.getLingerEvents();this._scribeLingerEvents(e)}})),i()(this,"_handleOnLingerEvents",(e=>{e.forEach((e=>this._handleOnLingerEvent(e)))})),i()(this,"_handleOnLingerEvent",(e=>{const{applyReactionInstructions:t}=this.props,r=this._getEntryIndex()[e];r&&t({entry:r,triggerName:ee.ON_LINGER})})),i()(this,"_handlePositionRestored",(()=>{this._positionedRestored=!0})),i()(this,"_scheduleNewEntriesScribing",(r=e=>{const{richScribeAction:t,scribeNamespace:r}=this.props,s=this._buildStreamScribeData(e);s.length>0&&t({...r,component:"stream",action:"results"},{items:s})},l.canUseDOM&&window.requestIdleCallback?e=>{const t=window.requestIdleCallback((()=>r(e)));return()=>window.cancelIdleCallback(t)}:l.canUseDOM&&window.requestAnimationFrame?e=>{const t=window.requestAnimationFrame((()=>r(e)));return()=>window.cancelAnimationFrame(t)}:()=>I.a)),i()(this,"_setScroller",(e=>{this._scroller=e})),i()(this,"_V2ImpressionsEnabled",(()=>l.canUseDOM&&window.IntersectionObserver&&this.context.featureSwitches.isTrue("responsive_web_linger_refactor_enabled"))),i()(this,"_newImpressionTrackerV2",(()=>this._V2ImpressionsEnabled()?new M.a({root:this.context.viewport.getViewport(),reactivityCallback:this._handleOnLingerEvent}):void 0)),this._impressionTracker=new N,this._streamScribeCancelCallbacks=[]}UNSAFE_componentWillReceiveProps(e){this.props.timelineId!==e.timelineId&&(this._flushLingerScribes(),this._impressionTracker=new N,this._impressionTrackerV2&&this._impressionTrackerV2.disconnect(),this._impressionTrackerV2=this._newImpressionTrackerV2())}componentDidMount(){const{isModal:e,onRef:t}=this.props;this._impressionTrackerV2=this._newImpressionTrackerV2(),this._initialize(),window.addEventListener("beforelogout",this._handleBeforeWindowUnload),window.addEventListener("beforeunload",this._handleBeforeWindowUnload),t&&t(this),e&&(ce=!0)}componentWillUnmount(){var e;const{isModal:t,onRef:r}=this.props;this._flushLingerScribes(),this._cancelStreamScribeCallbacks(),window.removeEventListener("beforelogout",this._handleBeforeWindowUnload),window.removeEventListener("beforeunload",this._handleBeforeWindowUnload),r&&r(void 0),t&&(ce=!1),null==(e=this._impressionTrackerV2)||e.disconnect()}componentDidUpdate(e){const{entries:t,handlerRegistry:r,timelineId:s,onRef:i}=this.props;s!==e.timelineId?this._initialize():t===e.entries&&r===e.handlerRegistry||this._scribeNewEntries(t),i&&i!==e.onRef&&i(this)}render(){const{anchoring:e,entries:t,handlerRegistry:r,showFooter:s,header:i,isInitialFocusEntry:c,nearStartProximityRatio:l,renderEmptyState:h,scrollerDisplayType:d,timelineId:p,title:m,module:u}=this.props,_=this.props.scroller,b=this._getInitialFocusedEntry(t,c),y=this._impressionTrackerV2?this._handleProcessLingerEvents:I.a,g=this._impressionTrackerV2?void 0:this._handleItemsRendered;return this._refreshControlWrapper(this._shouldRenderEmptyState(t)?h():o.createElement(B,{impressionTracker:this._impressionTrackerV2},o.createElement(a.a,{title:m},this._renderActiveCover(),this._renderPill(),o.createElement(V.a,{handlers:{[F.d.loadNewTweets]:this._handleRefreshKeyboardShortcut,[F.d.nextItem]:this._focusNext,[F.d.previousItem]:this._focusPrevious}},o.createElement(_,{anchoring:e,assumedItemHeight:te.b.isDesktopOS()?100:void 0,cacheKey:p,footer:s&&this._renderLoadBottom(),header:i,identityFunction:ne,initialAnchor:b&&n.b(ne(b)),items:t,nearStartProximityRatio:l,onAtEnd:this._handleAtBottom,onAtStart:this._handleAtTop,onItemsRendered:g,onNearEnd:this._handleNearBottom,onNearStart:this._handleNearTop,onPositionRestored:this._handlePositionRestored,onScrollEnd:y,ref:this._setScroller,renderer:this._getCellRenderer(r,u),scrollerDisplayType:d,sortIndexFunction:oe})))))}_renderPill(){const{alert:e,removeAlert:t,topUnseenCount:r,newTweetsPillMode:s,scribeNamespace:i,timelineId:n}=this.props;return s?s===Y.a.URT?o.createElement(Z.a.Configure,{alert:e,removeAlert:t,scribeNamespace:i,timelineId:n}):s===Y.a.CLIENT&&r&&r>0?o.createElement(Z.a.Configure,{removeAlert:t,scribeNamespace:i,timelineId:n,unreadCount:r}):void 0:null}_renderActiveCover(){const{activeCover:e,clearActiveCover:t,processCallback:r,scribeAction:s,scribeNamespace:i}=this.props,n=e&&e.cover;return e&&n?o.createElement(L,{activeCover:e,clearActiveCover:t,processCallback:r,scribeAction:s,scribeNamespace:i}):null}_shouldRenderEmptyState(e){const{activeCover:t,initialFetchStatus:r}=this.props,s=r===A.a.LOADED,i=0===e.length;return s&&i&&!t}_getEntryIndex(){return this._createEntryIndex(this.props.entries)}_initialize(){this._scribeNewEntries(this.props.entries)}_flushLingerScribes(){const e=this._impressionTrackerV2?this._impressionTrackerV2.flushLingerEvents():this._impressionTracker.flushLingerEvents();this._scribeLingerEvents(e)}refreshOrGoTop(e){this._scroller&&!this._scroller.isAtTop()?this.scrollToTop(e):this.props.onRefresh()}_proximityHandler(e){return t=>{this._positionedRestored&&e(t)}}_scribeNewEntries(e){const t=this._scheduleNewEntriesScribing(e);for(this._streamScribeCancelCallbacks.push(t);this._streamScribeCancelCallbacks.length>=20;)this._streamScribeCancelCallbacks.shift()}_buildStreamScribeData(e){const{scribeCache:t,timelineId:r,handlerRegistry:s}=this.props;let i=null;if(!t.has(r)){const e=new Set;t.set(r,e)}const n=t.get(r);return n?e.reduce(((e,t,r)=>{const{entryId:o}=t;let a=!1;if(t.content&&t.content.promotedMetadata&&(a=t.content.promotedMetadata),!n.has(o)&&!s.getNeedsLoad(t)){n.add(o);const r=this._getScribeDataItem(s,t);r&&(a&&null!==i&&(r.tweet_count=i),e.push(r))}return a?i=0:null!==i&&-1===t.type.indexOf("ui_")&&(i+=1),e}),[]):[]}_storeSeenIds(e){const{seenIds:t,seenIdsLatest:r,timelineId:s}=this.props;"home"===s&&t?t.addNewTweets(e):"home-latest"===s&&r&&r.addNewTweets(e)}_scribeLingerEvents(e){if(0===e.length)return;const{handlerRegistry:t}=this.props,r=this._getEntryIndex(),s=[],i=[];if(e.forEach((({id:e,start:n,end:o})=>{const a=r[e];if(a){const e=this._getScribeDataItem(t,a);if(e){const t={visibility_start:n,visibility_end:o};s.push({...e,impression_details:t})}a.type===R.b.Tweet&&i.push(a.content.id)}})),s.length>0){const{richScribeAction:e,scribeNamespace:t}=this.props;e({...t,component:"stream",element:"linger",action:"results"},{items:s})}i.length>0&&this._storeSeenIds(i)}_getScribeDataItem(e,t){const r=e.getHandler(t);if(r)return r.getScribeDataItem(t)}_cancelStreamScribeCallbacks(){this._streamScribeCancelCallbacks.forEach((e=>e()))}}i()(le,"contextType",c.a),i()(le,"defaultProps",{showFooter:!0,onBottomRetry:I.a,onNearBottom:I.a,onNearTop:I.a,onRefresh:I.a,refreshControl:Q.a,scribeCache:ae,scroller:X.b,scrollerDisplayType:$.a.Vertical,seenIds:Object(re.b)(),seenIdsLatest:Object(re.a)(),withKeyboardShortcuts:!0});t.default=le},"n+Zb":function(e,t,r){"use strict";r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return i}));const s=e=>({id:e,distanceToViewportTop:0}),i=e=>({id:e,distanceToViewportBottom:0})}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.TimelineRenderer.eabc1595.js.map